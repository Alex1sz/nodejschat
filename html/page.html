<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    <section>
      <div id="chat"></div>
      <input type="text" id="name" placeholder="your name" />
      <input type="text" id="input" disabled="disabled" />
    </section>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      window.onload = function() {
        var Chat = (function() {
          var addEventListener = function(obj, evt, fnc) {
            if (obj.addEventListener) { // W3C model
                obj.addEventListener(evt, fnc, false);
                return true;
            } else if (obj.attachEvent) { // Microsoft model
                return obj.attachEvent('on' + evt, fnc);
            }
          }
          var getRandomColor = function() {
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i < 6; i++) {
                color += letters[Math.round(Math.random() * 15)];
            }
            return color;
          }
          var socket = io.connect('http://localhost:3000'),
            chat = document.querySelector("#chat"),
            input = document.querySelector("#input"),
            name = document.querySelector("#name"),
            color = getRandomColor();
          var send = function(message) {
            var username = name.value === '' ? '' : '<strong>' + name.value + ': </strong>';
            socket.emit('send', {
              message: '<span style="color:' + color + '">' + username + message + '</span>'
            });
          }
          var display = function(message) {
            chat.innerHTML = chat.innerHTML + message + '<br />';
            chat.scrollTop = chat.scrollHeight;
          }
          addEventListener(input, "keydown", function(e) {
            if(e.keyCode === 13) {
              send(input.value);
              input.value = "";
            }
          });
          socket.on('welcome', function (data) {
            display(data.message);
            input.removeAttribute("disabled");
            input.focus();
          }).on('receive', function(data) {
            display(data.message);
          });
        })();
      }
    </script>
  </body>
</html>
